function openDatabaseAndReplayRequests(){var indexedDBOpenRequest=indexedDB.open("offline-analytics",IDB_VERSION);indexedDBOpenRequest.onerror=function(error){},indexedDBOpenRequest.onupgradeneeded=function(){this.result.createObjectStore(STORE_NAME,{keyPath:"url"})},indexedDBOpenRequest.onsuccess=function(){idbDatabase=this.result,replayAnalyticsRequests()}}function getObjectStore(storeName,mode){return idbDatabase.transaction(storeName,mode).objectStore(storeName)}function replayAnalyticsRequests(){var savedRequests=[];getObjectStore(STORE_NAME).openCursor().onsuccess=function(event){var cursor=event.target.result;cursor?(savedRequests.push(cursor.value),cursor.continue()):savedRequests.forEach(function(savedRequest){var queueTime=Date.now()-savedRequest.timestamp;if(queueTime>STOP_RETRYING_AFTER)getObjectStore(STORE_NAME,"readwrite").delete(savedRequest.url);else{var requestUrl=savedRequest.url+"&qt="+queueTime;fetch(requestUrl).then(function(response){response.status<400&&getObjectStore(STORE_NAME,"readwrite").delete(savedRequest.url)}).catch(function(error){})}})}}function checkForAnalyticsRequest(requestUrl){var url=new URL(requestUrl);"www.google-analytics.com"!==url.hostname&&"ssl.google-analytics.com"!==url.hostname||"/collect"!==url.pathname||saveAnalyticsRequest(requestUrl)}function saveAnalyticsRequest(requestUrl){getObjectStore(STORE_NAME,"readwrite").add({url:requestUrl,timestamp:Date.now()})}var CACHE_VERSION=1,CURRENT_CACHES={"offline-analytics":"offline-analytics-v"+CACHE_VERSION},idbDatabase,IDB_VERSION=1,STOP_RETRYING_AFTER=864e5,STORE_NAME="urls";openDatabaseAndReplayRequests(),self.addEventListener("activate",function(event){var expectedCacheNames=Object.keys(CURRENT_CACHES).map(function(key){return CURRENT_CACHES[key]});event.waitUntil(caches.keys().then(function(cacheNames){return Promise.all(cacheNames.map(function(cacheName){return-1===expectedCacheNames.indexOf(cacheName)?caches.delete(cacheName):void 0}))}))});var urlsToCache=["/","/lib/jquery/dist/jquery.min.js","/js/app.min.js","/js/lib.min.js","/css/app.min.css","https://fonts.googleapis.com/css?family=Quicksand:300,400,700","https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js","/favicon-16x16.png","/favicon-96x96.png","/favicon-32x32.png","/apple-icon-57x57.png","/apple-icon-60x60.png","/apple-icon-72x72.png","/apple-icon-76x76.png","/apple-icon-114x114.png","/apple-icon-120x120.png","/apple-icon-144x144.png","/apple-icon-152x152.png","/apple-icon-180x180.png","/android-icon-192x192.png","/favicon.ico","/manifest.json","/ms-icon-144x144.png"];self.addEventListener("install",function(event){event.waitUntil(caches.open(CURRENT_CACHES["offline-analytics"]).then(function(cache){return cache.addAll(urlsToCache)}))}),self.addEventListener("fetch",function(event){event.respondWith(caches.open(CURRENT_CACHES["offline-analytics"]).then(function(cache){return cache.match(event.request).then(function(response){return response?response:fetch(event.request.clone()).then(function(response){return response.status<400?cache.put(event.request,response.clone()):response.status>=500&&checkForAnalyticsRequest(event.request.url),response}).catch(function(error){throw checkForAnalyticsRequest(event.request.url),error})}).catch(function(error){throw error})}))});